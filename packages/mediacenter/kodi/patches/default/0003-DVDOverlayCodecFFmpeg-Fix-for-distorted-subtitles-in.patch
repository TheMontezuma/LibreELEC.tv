From b9786b9dcc29429af69506cb950a48f4dc55a221 Mon Sep 17 00:00:00 2001
From: Marcin Sochacki <marcin.sochacki@gmx.net>
Date: Mon, 29 May 2023 17:04:16 +0200
Subject: [PATCH 3/3] DVDOverlayCodecFFmpeg: Fix for distorted subtitles in 3D
 modes (part 2) add AV_CODEC_ID_DVD_SUBTITLE handling

Signed-off-by: Marcin Sochacki <marcin.sochacki@gmx.net>
---
 .../DVDCodecs/Overlay/DVDOverlayCodecFFmpeg.cpp           | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/xbmc/cores/VideoPlayer/DVDCodecs/Overlay/DVDOverlayCodecFFmpeg.cpp b/xbmc/cores/VideoPlayer/DVDCodecs/Overlay/DVDOverlayCodecFFmpeg.cpp
index 4195f93657..b4697bc23d 100644
--- a/xbmc/cores/VideoPlayer/DVDCodecs/Overlay/DVDOverlayCodecFFmpeg.cpp
+++ b/xbmc/cores/VideoPlayer/DVDCodecs/Overlay/DVDOverlayCodecFFmpeg.cpp
@@ -233,7 +233,8 @@ CDVDOverlay* CDVDOverlayCodecFFmpeg::GetOverlay()
 
     RENDER_STEREO_MODE render_stereo_mode = CServiceBroker::GetWinSystem()->GetGfxContext().GetStereoMode();
     if (render_stereo_mode != RENDER_STEREO_MODE_OFF &&
-        m_pCodecContext->codec_id != AV_CODEC_ID_HDMV_PGS_SUBTITLE)
+        m_pCodecContext->codec_id != AV_CODEC_ID_HDMV_PGS_SUBTITLE &&
+        m_pCodecContext->codec_id != AV_CODEC_ID_DVD_SUBTITLE)
     {
       if (rect.h > m_height / 2)
       {
@@ -263,9 +264,10 @@ CDVDOverlay* CDVDOverlayCodecFFmpeg::GetOverlay()
     overlay->bForced  = rect.flags != 0;
 
     if (render_stereo_mode != RENDER_STEREO_MODE_OFF &&
-        m_pCodecContext->codec_id == AV_CODEC_ID_HDMV_PGS_SUBTITLE)
+        m_pCodecContext->codec_id == AV_CODEC_ID_HDMV_PGS_SUBTITLE &&
+        m_pCodecContext->codec_id == AV_CODEC_ID_DVD_SUBTITLE)
     {
-      // For PGS subtitles we don't set source_width and source_height here.
+      // For PGS and DVD subtitles we don't set source_width and source_height here.
       // Later this will lead to 'video alignment' being chosen for that subtitle.
       overlay->source_width  = 0;
       overlay->source_height = 0;
-- 
2.17.1

